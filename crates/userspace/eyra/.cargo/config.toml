# TEAM_374: Static-PIE configuration for Eyra userspace binaries
# Required for LevitateOS which has no dynamic linker
# TEAM_380: Added sysroot and -nostartfiles for aarch64 cross-compilation
#
# IMPORTANT: -nostartfiles is REQUIRED for all Eyra binaries
# ============================================================
# Eyra's Origin crate provides its own _start symbol (via origin-start feature).
# By default, GCC links crt1.o which also defines _start, causing duplicate symbols.
# The -nostartfiles flag prevents linking system startup files, allowing Origin's
# _start to be the only entry point.
#
# This is configured at the workspace level so individual binaries don't need
# build.rs files with println!("cargo:rustc-link-arg=-nostartfiles").

[target.x86_64-unknown-linux-gnu]
rustflags = [
    "-C", "target-feature=+crt-static",
    "-C", "relocation-model=pic",
    "-C", "link-arg=-nostartfiles",
]

[target.aarch64-unknown-linux-gnu]
linker = "aarch64-linux-gnu-gcc"
rustflags = [
    "-C", "target-feature=+crt-static",
    "-C", "relocation-model=pic",
    "-C", "link-arg=--sysroot=/usr/aarch64-redhat-linux/sys-root/fc43",
    "-C", "target-feature=-outline-atomics",
    "-C", "link-arg=-nostartfiles",
]
