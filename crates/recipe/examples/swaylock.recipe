; swaylock - Screen locker for Wayland
; https://github.com/swaywm/swaylock

(package "swaylock" "1.8.0"
  (description "Screen locker for Wayland compositors")
  (license "MIT")
  (homepage "https://github.com/swaywm/swaylock")

  (deps
    (build "meson" "ninja" "pkg-config" "scdoc")
    (runtime
      "wayland"
      "wayland-protocols"
      "cairo"
      "gdk-pixbuf"
      "pam"
      "libxkbcommon"))

  (acquire
    (source "https://github.com/swaywm/swaylock/releases/download/v1.8.0/swaylock-1.8.0.tar.gz"
      (sha256 "TODO")))

  (build
    (configure "meson setup build --prefix=$PREFIX \
      -Dpam=enabled \
      -Dgdk-pixbuf=enabled \
      -Dman-pages=enabled")
    (compile "ninja -C build -j$NPROC"))

  (install
    (shell "DESTDIR=$DESTDIR ninja -C build install"))

  (configure
    ; PAM config for swaylock
    (to-config "pam.d/swaylock" "/etc/pam.d/swaylock"))

  (cleanup sources))
