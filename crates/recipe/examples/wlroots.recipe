; wlroots - Modular Wayland compositor library
; https://gitlab.freedesktop.org/wlroots/wlroots

(package "wlroots" "0.18.1"
  (description "Modular Wayland compositor library")
  (license "MIT")
  (homepage "https://gitlab.freedesktop.org/wlroots/wlroots")

  (deps
    (build "meson" "ninja" "pkg-config" "hwdata")
    (runtime
      "wayland"
      "wayland-protocols"
      "libxkbcommon"
      "libinput"
      "libdrm"
      "mesa"            ; EGL/GLES
      "pixman"
      "seatd"           ; seat management
      "libdisplay-info" ; EDID parsing
      "libliftoff"))    ; KMS plane allocation

  (acquire
    (source "https://gitlab.freedesktop.org/wlroots/wlroots/-/releases/0.18.1/downloads/wlroots-0.18.1.tar.gz"
      (sha256 "TODO")))

  (build
    (configure "meson setup build --prefix=$PREFIX \
      -Dexamples=false \
      -Dxwayland=disabled \
      -Dbackends=drm,libinput \
      -Drenderers=gles2")
    (compile "ninja -C build -j$NPROC"))

  (install
    (shell "DESTDIR=$DESTDIR ninja -C build install"))

  (cleanup sources))
