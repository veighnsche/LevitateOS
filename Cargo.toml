[workspace]
members = [
    "crates/kernel",
    "crates/hal",
    "crates/utils",
    "crates/term",
    "crates/pci",
    "crates/gpu",
    "crates/virtio-transport",
    "crates/drivers/virtio-blk",
    "crates/drivers/virtio-gpu",
    "crates/drivers/virtio-input",
    "crates/drivers/virtio-net",
    "crates/drivers/nvme",
    "crates/drivers/xhci",
    "crates/drivers/simple-gpu",
    "crates/error",
    "crates/traits/input-device",
    "crates/traits/network-device",
    "crates/traits/storage-device",
    "xtask",
]
exclude = [
    "crates/userspace",
]
default-members = ["crates/hal", "crates/utils", "xtask"]
resolver = "2"

[workspace.lints.rust]
unsafe_op_in_unsafe_fn = "allow"
unconditional_panic = "deny"

[workspace.lints.clippy]
# Rule 5 & 6: Safety and Robustness
unwrap_used = "deny"
expect_used = "deny"
missing_safety_doc = "deny"
panic = "deny"
todo = "warn"
unimplemented = "warn"
# Rule 13: Representation - exhaustive matches
match_same_arms = "deny"
# Rule 20: Economy - efficient abstractions
pedantic = { level = "warn", priority = -1 }
# Overrides to reduce noise in bare-metal kernel development
module_name_repetitions = "allow"
must_use_candidate = "allow"
cast_possible_truncation = "allow"
cast_precision_loss = "allow"
cast_sign_loss = "allow"
ptr_as_ptr = "allow"
missing_panics_doc = "allow"
missing_errors_doc = "allow"

[profile.dev]
panic = "abort"

[profile.release]
panic = "abort"
lto = false # TEAM_301: Disable LTO for debugging
debug = true # TEAM_301: Enable debug symbols
codegen-units = 1

# TEAM_141: Pin shared dependencies to avoid version skew across crates
[workspace.dependencies]
virtio-drivers = "0.12"
embedded-graphics = "0.8.1"
bitflags = "2.10.0"
aarch64-cpu = "11.2"
spin = { version = "0.10", default-features = false, features = ["once", "lazy", "barrier", "rwlock", "spin_mutex"] }
hashbrown = { version = "0.14", default-features = false, features = ["inline-more", "ahash"] }
# TEAM_284: Critical libraries for x86_64 and hardware support
x86_64 = "0.15"
volatile = "0.6"
bytemuck = { version = "1.21", features = ["derive"] }
acpi = "5.0"
aml = "0.16"
